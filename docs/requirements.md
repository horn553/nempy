# nempy 要件定義書

## 1. プロジェクト概要

### 1.1 基本情報

- **名称**: nempy
- **目的**: 燃費管理を中心とした車の維持管理に便利な機能を、スマートにまとめる
- **対象ユーザー**: 車を所有する個人
- **言語**: 日本語のみ

### 1.2 主要機能

- Googleアカウントによる認証（サインアップ・ログイン）
- 複数車両の管理
- 給油記録の登録・管理
- 燃費計算・可視化（ダッシュボード）
- 車両の共有機能
- データエクスポート機能

## 2. 機能要件

### 2.1 認証・権限管理

- **認証方式**: OAuth 2.0（Lucia使用）によるGoogleアカウント認証
- **権限レベル**:
  - 閲覧者: データの閲覧のみ可能
  - 編集者: データの追加・編集が可能
  - 管理者: 全権限（削除・共有設定変更を含む）
- **車両共有**: 共有リンクの作成・配布による

### 2.2 データモデル

#### 2.2.1 ユーザー

- Googleアカウント情報（ID、名前、メールアドレス）
- 登録日時

#### 2.2.2 車両

- 基本情報
  - メーカー
  - 車種
  - 燃料タイプ（ガソリン/軽油/ハイブリッド等）
  - メモ
- 所有者・共有設定

#### 2.2.3 給油記録

- 日時
- ガソリンスタンド名
- 走行距離（オドメーター値）
- 燃料単価
- 給油量
- 満タンフラグ（燃費計算用）

### 2.3 画面機能

#### 2.3.1 ダッシュボード

- 走行距離の推移
- 区間燃費・平均燃費の推移（棒グラフ）
- 最新の各種数値表示
- 表示期間: 初期値は全期間、フィルタリング可能

#### 2.3.2 給油記録追加

- 入力の効率化
  - 位置情報による給油場所の自動サジェスト
  - 前回の燃料単価をデフォルト値として表示
- 必須入力項目の最小化

#### 2.3.3 データ管理

- 給油記録の一覧表示・編集・削除
- CSVエクスポート機能

## 3. 非機能要件

### 3.1 パフォーマンス

- **初回ロード時間**: 3秒以内（モバイル4G環境）
- **ページ遷移**: 1秒以内
- **給油記録追加画面**: 1秒以内で表示
- **ダッシュボード**: 2秒以内（グラフ描画含む）
- **API応答時間**: 200ms以内
- **Core Web Vitals**:
  - LCP: 2.5秒以内
  - FID: 100ms以内
  - CLS: 0.1以内

### 3.2 可用性・信頼性

- **同時アクセス数**: 100人程度
- **データ保持期間**: 全期間（当面は無制限）

### 3.3 バックアップ・リカバリ

- **バックアップ頻度**: 日次自動バックアップ
- **保持期間**: 30日間
- **RPO**: 24時間以内のデータ損失まで許容
- **RTO**: 4時間以内に復旧
- **実装方針**:
  - Cloudflare D1の自動バックアップ機能を活用
  - ユーザー自身でのCSVダウンロード機能を提供

### 3.4 セキュリティ

- HTTPS通信の強制
- OAuth 2.0による安全な認証
- 適切なアクセス制御（権限管理）
- SQLインジェクション対策（Drizzle ORM使用）

## 4. 技術要件

### 4.1 技術スタック

- **フロントエンド**:
  - SvelteKit
  - Svelte
  - TypeScript
  - Skeleton UI（コンポーネントライブラリ）
- **バックエンド**:
  - Cloudflare Workers
- **データベース**:
  - Cloudflare D1
  - Drizzle ORM
- **認証**:
  - Lucia（OAuth 2.0）
- **CI/CD**:
  - GitHub Actions
  - Git pre-commit hooks（Prettier, ESLint, svelte-check）
- **テスト**:
  - Vitest（単体テスト）

### 4.2 アーキテクチャ方針

- **設計手法**: DDD（ドメイン駆動設計）、クリーンアーキテクチャ
- **実装方針**:
  - クラスを使用せず、オブジェクトで実装
  - 関数型プログラミングに準拠
  - イミュータブルなオブジェクト設計
  - エラーハンドリングはResult型を使用（例外をthrowしない）

### 4.3 UI/UX方針

- モバイルファーストデザイン
- レスポンシブ対応
- PWA非対応（将来的な拡張は可能）
- オフライン機能なし

## 5. 制約事項

- 日本語のみ対応（国際化対応なし）
- 燃費計算は満タン法のみ対応
- 給油リマインダー機能は実装しない

## 6. 将来的な拡張性

- メンテナンス記録機能
- 車検・保険の期限管理
- 燃費ランキング機能
- 他ユーザーとの比較機能
